<template>
  <div class="container" id="capture">
    <div class="leftbar">
      <template>
        <t-menu
          theme="light"
          defaultValue="item2"
          :collapsed="collapsed"
          @change="changeHandler"
          height="550px"
        >
          <template #logo>
            <!-- <img :width="collapsed ? 35 : 136" :src="iconUrl" alt="logo" /> -->
          </template>
          <t-menu-group title="ç»„ä»¶">
            <t-submenu title="ç”»å¸ƒå¤§å°" value="2-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="2-1-1" @click="changeCanvas('500px', '500px')"
                >IPONE
              </t-menu-item>
              <t-menu-item
                value="2-1-2"
                @click="changeCanvas('600px', '1024px')"
                >7å¯¸å¹³æ¿ç”µè„‘(600Ã—1024)</t-menu-item
              >
              <t-menu-item
                value="2-1-3"
                @click="changeCanvas('720px', '1280px')"
                >10å¯¸å¹³æ¿ç”µè„‘(720Ã—1280)</t-menu-item
              >
              <t-menu-item
                value="2-1-4"
                @click="changeCanvas('1024px', '768px')"
                >iPad(1024Ã—768)</t-menu-item
              >
            </t-submenu>

            <t-submenu title="Layout" value="3-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="3-1-1" @click="cloneElement('Layout1')"
                >ä¾§è¾¹å¯¼èˆªå¸ƒå±€
              </t-menu-item>
              <t-menu-item value="3-1-2" @click="cloneElement('Layout2')"
                >é¡¶éƒ¨å¯¼èˆªå¸ƒå±€</t-menu-item
              >
              <t-menu-item value="3-1-3" @click="cloneElement('Layout3')"
                >ç»„åˆå¯¼èˆªå¸ƒå±€</t-menu-item
              >
            </t-submenu>

            <t-submenu title="Button" value="4-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="4-1-1" @click="cloneElement('Button1')"
                >å¡«å……æŒ‰é’®
              </t-menu-item>
              <t-menu-item value="4-1-2" @click="cloneElement('Button2')"
                >æè¾¹æŒ‰é’®</t-menu-item
              >
              <t-menu-item value="4-1-3" @click="cloneElement('Button3')"
                >è™šæ¡†æŒ‰é’®</t-menu-item
              >
              <t-menu-item value="4-1-4" @click="cloneElement('Button4')"
                >æ–‡å­—æŒ‰é’®</t-menu-item
              >
            </t-submenu>

            <t-submenu title="Divider" value="5-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="5-1-1" @click="cloneElement('Divider1')"
                >åŸºç¡€åˆ†å‰²çº¿
              </t-menu-item>
              <t-menu-item value="5-1-2" @click="cloneElement('Divider2')"
                >æ°´å¹³åˆ†å‰²çº¿</t-menu-item
              >
              <t-menu-item value="5-1-3" @click="cloneElement('Divider3')"
                >å‚ç›´åˆ†å‰²çº¿</t-menu-item
              >
              <t-menu-item value="5-1-4" @click="cloneElement('Divider4')"
                >å¸¦æ–‡å­—çš„åˆ†å‰²çº¿</t-menu-item
              >
            </t-submenu>

            <t-submenu title="Breadcrumb" value="6-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="6-1-1" @click="cloneElement('Breadcrumb1')"
                >åŸºç¡€é¢åŒ…å±‘
              </t-menu-item>
              <t-menu-item value="6-1-2" @click="cloneElement('Breadcrumb2')"
                >å¸¦å›¾æ ‡çš„é¢åŒ…å±‘</t-menu-item
              >
              <t-menu-item value="6-1-3" @click="cloneElement('Breadcrumb3')"
                >è‡ªå®šä¹‰åˆ†éš”ç¬¦çš„é¢åŒ…å±‘</t-menu-item
              >
              <t-menu-item value="6-1-4" @click="cloneElement('Breadcrumb4')"
                >å¸¦è·³è½¬/ç‚¹å‡»çš„é¢åŒ…å±‘</t-menu-item
              >
            </t-submenu>

            <t-submenu title="DropDown" value="7-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="7-1-1" @click="cloneElement('Dropdown1')"
                >æ–‡å­—ä¸‹æ‹‰èœå•
              </t-menu-item>
              <t-menu-item value="7-1-2" @click="cloneElement('Dropdown2')"
                >å¤šå±‚ä¸‹æ‹‰èœå•</t-menu-item
              >
              <t-menu-item value="7-1-3" @click="cloneElement('Dropdown3')"
                >å¸¦ç¦ç”¨æ“ä½œé¡¹çš„ä¸‹æ‹‰èœå•</t-menu-item
              >
              <t-menu-item value="7-1-4" @click="cloneElement('Dropdown4')"
                >è‡ªå®šä¹‰ä¸»é¢˜çš„ä¸‹æ‹‰èœå•</t-menu-item
              >
              <t-menu-item value="7-1-5" @click="cloneElement('Dropdown5')"
                >å¸¦å›¾æ ‡çš„ä¸‹æ‹‰èœå•</t-menu-item
              >
            </t-submenu>

            <t-submenu title="Menu" value="8-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="8-1-1" @click="cloneElement('Menu1')"
                >é¡¶éƒ¨å•å±‚å¯¼èˆª
              </t-menu-item>
              <t-menu-item value="8-1-2" @click="cloneElement('Menu2')"
                >é¡¶éƒ¨åŒå±‚å¯¼èˆª</t-menu-item
              >
              <t-menu-item value="8-1-3" @click="cloneElement('Menu3')"
                >é¡¶éƒ¨å¤šå±‚æ”¶çº³å¯¼èˆª</t-menu-item
              >
              <t-menu-item value="8-1-4" @click="cloneElement('Menu4')"
                >ä¾§è¾¹å•å±‚å¯¼èˆª</t-menu-item
              >
              <t-menu-item value="8-1-5" @click="cloneElement('Menu5')"
                >å¹³é“ºå¼ä¾§è¾¹å¯¼èˆª</t-menu-item
              >
            </t-submenu>

            <t-submenu title="Pagination" value="9-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="9-1-1" @click="cloneElement('Pagination1')"
                >å°‘é‡åˆ†é¡µ
              </t-menu-item>
              <t-menu-item value="9-1-2" @click="cloneElement('Pagination2')"
                >å¸¦æ•°æ®æ€»é‡æ˜¾ç¤ºçš„åˆ†é¡µ</t-menu-item
              >
              <t-menu-item value="9-1-3" @click="cloneElement('Pagination3')"
                >å¸¦é¡µé¢å±•ç¤ºæ•°é‡é€‰æ‹©çš„åˆ†é¡µ</t-menu-item
              >
              <t-menu-item value="9-1-4" @click="cloneElement('Pagination4')"
                >å¸¦å¿«é€Ÿè·³è½¬çš„åˆ†é¡µ</t-menu-item
              >
              <t-menu-item value="9-1-5" @click="cloneElement('Pagination5')"
                >æç®€ç‰ˆè¿·ä½ åˆ†é¡µ</t-menu-item
              >
            </t-submenu>

            <t-submenu title="Steps" value="10-1">
              <template #icon>
                <icon name="server" />
              </template>
              <t-menu-item value="10-1-1" @click="cloneElement('Steps1')"
                >ä¸å¸¦åºçš„æ°´å¹³æ­¥éª¤æ¡
              </t-menu-item>
              <t-menu-item value="10-1-2" @click="cloneElement('Steps2')"
                >ä¸å¸¦åºå·çš„å‚ç›´æ­¥éª¤æ¡</t-menu-item
              >
              <t-menu-item value="10-1-3" @click="cloneElement('Steps3')"
                >å¸¦çŠ¶æ€çš„æ­¥éª¤æ¡</t-menu-item
              >
              <t-menu-item value="10-1-4" @click="cloneElement('Steps4')"
                >å¸¦å›¾æ ‡çš„æ­¥éª¤æ¡</t-menu-item
              >
              <t-menu-item value="10-1-5" @click="cloneElement('Steps5')"
                >å¸¦é¢å¤–å†…å®¹çš„æ­¥éª¤æ¡</t-menu-item
              >
            </t-submenu>
          </t-menu-group>
          <t-menu-group title="å¯¼å‡º">
            <t-menu-item @click="downloadHtmlFile" value="item4">
              <template #icon>
                <icon name="login" />
              </template>
              å¯¼å‡ºHTML
            </t-menu-item>
            <t-menu-item @click="createPreview" value="item5">
              <template #icon>
                <icon name="login" />
              </template>
              é¢„è§ˆHTML
            </t-menu-item>

            <t-menu-item @click="captureAndSave" value="item6">
              <template #icon>
                <icon name="login" />
              </template>
              ä¸‹è½½å›¾ç‰‡
            </t-menu-item>
            <t-menu-item @click="saveProto" value="item47">
              <template #icon>
                <icon name="login" />
              </template>
              ä¿å­˜è¯¥åŸå‹
            </t-menu-item>
          </t-menu-group>

          <t-menu-item @click="goBack">
              <template #icon>
                <icon name="login" />
              </template>
              è¿”å›ä¸Šä¸€é¡µ
            </t-menu-item>
          <!-- <template #operations>
            <t-button
              class="t-demo-collapse-btn"
              variant="text"
              shape="square"
              @click.native="changeCollapsed"
            >
              <icon name="view-list" />
            </t-button>
          </template> -->
        </t-menu>
      </template>
    </div>

    <div class="main" style="width: 68.5%; height: 100%; padding: 20px">
      <vue-ruler-tool
        :content-layout="{ left: 0, top: 0 }"
        :is-scale-revise="true"
      >
        <div ref="elementToCapture" :style="computedStyle">
          <vue-draggable-resizable
            :parent="true"
            @deactivated="onDeselect($event, index)"
            v-for="(item, index) in clonedComponents"
            ref="draggableRes"
            :key="index"
            @resizing="
              (x, y, width, height) => innerResize(x, y, width, height, index)
            "
            @dragging="(x, y) => innerDrag(x, y, index)"
            @resizestop="innerResizeStop"
            :snap="true"
            @dragstop="innerDragStop"
            :w="x_scale[index]"
            :h="y_scale[index]"
            :x="x_off[index]"
            :y="y_off[index]"
            @activated="onSelected($event, index)"
            style="
              /* background-color: green; */
              border: 1px solid rgb(255, 255, 255);
              -webkit-transition: background-color 200ms linear;
              -ms-transition: background-color 200ms linear;
              transition: background-color 200ms linear;
            "
          >
            <div slot="" :style="computeColorStyle">
              {{ getName(index) }}
            </div>
            <div slot="tl">ğŸ˜€</div>
            <div slot="tm">ğŸ˜€</div>
            <div slot="tr">ğŸ˜€</div>
            <div slot="mr">ğŸ˜€</div>
            <div slot="br">ğŸ˜€</div>
            <div slot="bm">ğŸ˜€</div>
            <div slot="bl">ğŸ˜€</div>
            <div slot="ml">ğŸ˜€</div>
            <component-with-item :is="item"></component-with-item>
          </vue-draggable-resizable>
        </div>
      </vue-ruler-tool>
    </div>
  </div>
</template>
  
  <script>
import DragItem from "@/components/Prototype/DragItem.vue";
import ComponentA from "../components/Prototype/Components/ComponentA.vue";
import ComponentB from "../components/Prototype/Components/ComponentB.vue";
import ComponentC from "../components/Prototype/Components/ComponentC.vue";
import mDivider from "../components/Prototype/Components/mDivider.vue";
import mDropDown from "../components/Prototype/Components/mDropDown.vue";
import mLinkComponent from "../components/Prototype/Components/mLinkComponent.vue";
import mPagination from "../components/Prototype/Components/mPagination.vue";
import mTabs from "../components/Prototype/Components/mTabs.vue";
import mToolBar from "../components/Prototype/Components/mToolBar.vue";
import Dropdown1 from "../components/Prototype/Components/Dropdown1.vue";
import Dropdown2 from "../components/Prototype/Components/Dropdown2.vue";
import Dropdown3 from "../components/Prototype/Components/Dropdown3.vue";
import Dropdown4 from "../components/Prototype/Components/Dropdown4.vue";
import Dropdown5 from "../components/Prototype/Components/Dropdown5.vue";
import Menu1 from "../components/Prototype/Components/Menu1.vue";
import Menu2 from "../components/Prototype/Components/Menu2.vue";
import Menu3 from "../components/Prototype/Components/Menu3.vue";
import Menu4 from "../components/Prototype/Components/Menu4.vue";
import Menu5 from "../components/Prototype/Components/Menu5.vue";
import Pagination1 from "../components/Prototype/Components/Pagination1.vue";
import Pagination2 from "../components/Prototype/Components/Pagination2.vue";
import Pagination3 from "../components/Prototype/Components/Pagination3.vue";
import Pagination4 from "../components/Prototype/Components/Pagination4.vue";
import Pagination5 from "../components/Prototype/Components/Pagination5.vue";
import Steps1 from "../components/Prototype/Components/Steps1.vue";
import Steps2 from "../components/Prototype/Components/Steps2.vue";
import Steps3 from "../components/Prototype/Components/Steps3.vue";
import Steps4 from "../components/Prototype/Components/Steps4.vue";
import Steps5 from "../components/Prototype/Components/Steps5.vue";
import domToImage from "dom-to-image";
import testVue from "./test.vue";
import { Icon } from "tdesign-icons-vue";

//new component
import Button1 from "../components/Prototype/Components/Button1.vue";
import Button2 from "../components/Prototype/Components/Button2.vue";
import Button3 from "../components/Prototype/Components/Button3.vue";
import Button4 from "../components/Prototype/Components/Button4.vue";

import Layout1 from "../components/Prototype/Components/Layout1.vue";
import Layout2 from "../components/Prototype/Components/Layout2.vue";
import Layout3 from "../components/Prototype/Components/Layout3.vue";
import Layout4 from "../components/Prototype/Components/Layout4.vue";

import Divider1 from "../components/Prototype/Components/Divider1.vue";
import Divider2 from "../components/Prototype/Components/Divider2.vue";
import Divider3 from "../components/Prototype/Components/Divider3.vue";
import Divider4 from "../components/Prototype/Components/Divider4.vue";

import Breadcrumb1 from "../components/Prototype/Components/Bread1.vue";
import Breadcrumb2 from "../components/Prototype/Components/Bread2.vue";
import Breadcrumb3 from "../components/Prototype/Components/Bread3.vue";
import Breadcrumb4 from "../components/Prototype/Components/Bread4.vue";

import SideBar from "@/components/Layouts/SideBar.vue";
import VueRulerTool from "vue-ruler-tool";
// import TumblrButton from '../components/Buttons/TumblrButton.vue';
export default {
  data() {
    return {
      canvasX: "500px",
      canvasY: "500px",
      canvasColor: "white",
      previewContent: "",
      teamid: -1,
      ptid: -1,
      currentComponent: "ComponentA", // é»˜è®¤ç»‘å®š ComponentA ç»„ä»¶
      dynamicComponent: null,
      clonedComponents: [], // å­˜å‚¨å…‹éš†çš„ç»„ä»¶æ•°ç»„
      outDraggable: false,
      imageUrl: "",
      selectComponent: null,
      selectedIndex: -1,
      ws: null,
      new_join_info: "new",
      x_point: [
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0,
      ],
      y_point: [
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0,
      ],
      p_vis: [
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
      ],
      collapsed: false,
      index_name: [],
      name: "",
      x_off: [
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0,
      ],
      y_off: [
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0,
      ],
      x_scale: [
        100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
        100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
        100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
        100, 100, 100, 100, 100, 100, 100, 100,
      ],
      y_scale: [
        100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
        100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
        100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
        100, 100, 100, 100, 100, 100, 100, 100,
      ],
    };
  },
  components: {
    DragItem,
    ComponentA,
    ComponentB,
    ComponentC,
    mDivider,
    mDropDown,
    mLinkComponent,
    mPagination,
    mTabs,
    mToolBar,
    testVue,
    SideBar,
    Icon,
    Dropdown1,
    Dropdown2,
    Dropdown3,
    Dropdown4,
    Dropdown5,
    Menu1,
    Menu2,
    Menu3,
    Menu4,
    Menu5,
    Pagination1,
    Pagination2,
    Pagination3,
    Pagination4,
    Pagination5,
    Steps1,
    Steps2,
    Steps3,
    Steps4,
    Steps5,

    Button1,
    Button2,
    Button3,
    Button4,

    Layout1,
    Layout2,
    Layout3,
    Layout4,

    Divider1,
    Divider2,
    Divider3,
    Divider4,

    Breadcrumb1,
    Breadcrumb2,
    Breadcrumb3,
    Breadcrumb4,
  },
  mounted() {
    this.teamid = this.$route.params.teamid;
    this.ptid = this.$route.params.ptid;
    // TODO æ·»åŠ æ£€æµ‹
    document.addEventListener("keydown", this.handleKeyDown);
    this.ws = new WebSocket(
      "ws://182.92.86.71:4514/ws/editor/" + this.ptid + "/"
    );
    this.ws.onmessage = this.handleMessage;

    // this.ws.onopen = () => {
    //   this.sendMessage();
    // };
  },
  computed: {
    computedStyle() {
      return {
        backgroundColor: this.canvasColor,
        width: this.canvasX,
        height: this.canvasY,
      };
    },

    computeColorStyle() {
      var randomColor = this.getRandomColor(); // ä½¿ç”¨ä¹‹å‰æä¾›çš„è·å–éšæœºé¢œè‰²çš„å‡½æ•°

      // ç”ŸæˆåŒ…å«éšæœºé¢œè‰²å’Œ float: right æ ·å¼çš„å­—ç¬¦ä¸²
      var style = "float: right; background: " + randomColor + ";";

      return {
        // float: right,
        backgroundColor: randomColor,
        width: "50px",
        height: "auto",
      };
    },
  },
  destroyed() {
    document.removeEventListener("keydown", this.handleKeyDown);
  },
  methods: {
    async captureAndSave() {
      const element = this.$refs.elementToCapture; // æ›¿æ¢ä¸ºä½ çš„ DOM å…ƒç´ çš„å¼•ç”¨
      const htmlString = element.outerHTML;
      console.log(htmlString);
      // alert(element);
      this.imageUrl = await domToImage
        .toPng(element)
        .then((dataUrl) => {
          const a = document.createElement("a");
          a.setAttribute("download", "screenshot");
          a.href = dataUrl;
          a.click();
        })
        .catch((error) => {
          console.error("oops, something went wrong!", error);
        })
        .finally(this.close);
    },

    getRandomColor() {
      // ç”Ÿæˆä¸‰ä¸ªéšæœºçš„ 0 åˆ° 255 ä¹‹é—´çš„æ•´æ•°ä½œä¸º RGB å€¼
      var r = Math.floor(Math.random() * 256);
      var g = Math.floor(Math.random() * 256);
      var b = Math.floor(Math.random() * 256);

      // å°† RGB å€¼è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶è¡¥å…¨è‡³ 2 ä½
      var hexR = r.toString(16).padStart(2, "0");
      var hexG = g.toString(16).padStart(2, "0");
      var hexB = b.toString(16).padStart(2, "0");

      // æ‹¼æ¥æˆåå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²å¹¶è¿”å›
      var color = "#" + hexR + hexG + hexB;
      return color;
    },
    getName(index) {
      const tmp = this.index_name.filter((item) => item.index === index);
      console.log(tmp[0]);
      if (tmp[0] !== undefined && tmp[0] !== null) {
        return tmp[0].name;
      } else {
        return "";
      }
    },

    handleMessage(event) {
      const data = JSON.parse(event.data);

      if (this.new_join_info !== "new") {
        this.clonedComponents = data.message;
        this.x_off = data.x_off;
        this.y_off = data.y_off;
        this.x_scale = data.x_scale;
        this.y_scale = data.y_scale;
        this.canvasX = data.x_canvas;
        this.canvasY = data.y_canvas;
        this.x_point = data.x_point;
        this.y_point = data.y_point;
        this.p_vis = data.p_vis;
        this.index_name = data.index_name;
      } else {
        this.sendMessage();
      }

      console.log("receive");
    },

    sendMessage() {
      const sendData = JSON.stringify({
        message: this.clonedComponents,
        x_off: this.x_off,
        y_off: this.y_off,
        x_scale: this.x_scale,
        y_scale: this.y_scale,
        x_canvas: this.canvasX,
        y_canvas: this.canvasY,
        x_point: this.x_point,
        y_point: this.y_point,
        p_vis: this.p_vis,
        new_join_info: this.new_join_info,
        index_name: this.index_name,
      });
      this.ws.send(sendData);
      this.new_join_info = "old";
    },

    downloadHtmlFile(fileName) {
      const element = this.$refs.elementToCapture; // DOM å…ƒç´ çš„å¼•ç”¨
      const htmlString = element.outerHTML;
      console.log(htmlString);
      // alert(element);
      const htmlContent = htmlString;
      this.previewContent = htmlString;
      const blob = new Blob([htmlContent], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = fileName;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    },

    handleClick(context) {
      console.log("click", context);
    },
    handleHover(context) {
      console.log("hover", context);
    },
    cloneElement(ClonedComponent) {
      this.clonedComponents.push(ClonedComponent); // å°†å…‹éš†çš„ç»„ä»¶æ·»åŠ åˆ°æ•°ç»„ä¸­
      this.sendMessage();
    },
    handleKeyDown(event) {
      // æ£€æµ‹é”®ç›˜äº‹ä»¶å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†
      if (event.keyCode === 13) {
        // æŒ‰ä¸‹äº†å›è½¦é”® (Enter)
        console.log("enter");
      } else if (event.keyCode === 27) {
        // æŒ‰ä¸‹äº† Esc é”®
        console.log("esc");
      } else if (event.keyCode === 46 || event.keyCode === 8) {
        this.clonedComponents.splice(this.selectedIndex, 1);
        this.x_off.splice(this.selectedIndex, 1);
        this.y_off.splice(this.selectedIndex, 1);
        this.x_scale.splice(this.selectedIndex, 1);
        this.y_scale.splice(this.selectedIndex, 1);

        this.index_name = this.index_name.filter(
          (item) => item.id !== this.selectedIndex
        );

        this.index_name.forEach((item) => {
          if (item.index > this.selectedIndex) {
            item.index--;
          }
        });
        /*
        
        x_off: this.x_off,
        y_off: this.y_off,
        x_scale: this.x_scale,
        y_scale: this.y_scale,
        */
        console.log("delete");
        this.sendMessage();
      }
    },
    innerDrag: function (x, y, index) {
      this.dragging = true;
      this.x_off[index] = x;
      this.y_off[index] = y;
      // this.x = x;
      // this.y = y;
      console.log();
    },

    innerDragStop() {
      this.outDraggable = true;
      console.log("stop!!!");
      this.sendMessage();
    },
    innerResize: function (x, y, w, h, index) {
      this.x_off[index] = x;
      this.y_off[index] = y;
      this.x_scale[index] = w;
      this.y_scale[index] = h;
      console.log(w, h);
      // this.w = w;
      // this.h = h;
    },
    innerResizeStop() {
      console.log("stop!!!");
      this.sendMessage();
    },

    outerActive() {
      this.outDraggable = true;
    },
    onSelected(event, index) {
      this.selectedIndex = index;

      const data = {
        index: this.selectedIndex,
        name: this.$store.state.curUserName,
      };

      this.index_name.push(data);

      this.sendMessage();
    },
    onDeselect(event, index) {
      this.selectedIndex = index;

      this.index_name = this.index_name.filter(
        (item) => item.index !== this.selectedIndex
      );
      this.sendMessage();
    },

    changeHandler(active) {
      console.log("change", active);
    },
    changeCollapsed() {
      this.collapsed = !this.collapsed;
      this.iconUrl = this.collapsed
        ? "https://oteam-tdesign-1258344706.cos.ap-guangzhou.myqcloud.com/site/logo%402x.png"
        : "https://tdesign.gtimg.com/site/baseLogo-light.png";
    },
    changeCanvas(x, y) {
      this.canvasX = x;
      this.canvasY = y;
      console.log(x, y);
      this.sendMessage();
    },
    onDelete() {},
    goBack(){
      this.$router.go(-1);
    },

    createPreview() {
      const element = this.$refs.elementToCapture; // DOM å…ƒç´ çš„å¼•ç”¨
      const htmlString = element.outerHTML;
      console.log(htmlString);
      // alert(element);
      const htmlContent = htmlString;
      this.previewContent = htmlString;

      this.$router.push({
        name: "preview",
        params: { teamid: this.teamid, ptid: this.ptid },
        query: { htmlString },
      });
    },

    test() {
      console.log("hihihi");
    },
    // å­˜ç»™æœåŠ¡å™¨
    saveProto() {
      const saveData = JSON.stringify({
        message: this.clonedComponents,
        x_off: this.x_off,
        y_off: this.y_off,
        x_scale: this.x_scale,
        y_scale: this.y_scale,
        x_canvas: this.canvasX,
        y_canvas: this.canvasY,
      });

      const sdmsg = {
        prototype_id: this.ptid,
        prototype_components: saveData,
      };

      this.$api.doc
        .post_save_prototype_components(sdmsg)
        .then((res) => {
          if (res.data["errno"] === 0) {
            console.log("å‚æ•°ä¿å­˜æˆåŠŸ");
            this.$message({
              message: "ä¿å­˜æˆåŠŸ",
              type: "success",
            });
          } else {
            this.$message({
              message: "ä¿å­˜å¤±è´¥",
              type: "warning",
            });
            console.log("å‚æ•°ä¿å­˜å¤±è´¥ï¼š" + res.data["errno"]);
          }
        })
        .catch((err) => {
          this.$message({
            message: "ä¿å­˜å¤±è´¥",
            type: "warning",
          });
          console.log("è·å¾—error");
        });
    },
  },

  created() {
    this.teamid = this.$route.params.teamid;
    this.ptid = this.$route.params.ptid;
    const data = {
      prototype_id: this.ptid,
    };

    console.log("ptid:" + this.ptid);

    this.$api.doc
      .post_get_prototype_components(data)
      .then((res) => {
        if (res.data["errno"] === 0) {
          console.log("Sent Successfully!");
          const ddata = JSON.parse(res.data["components"]);
          this.clonedComponents = ddata.message;
          this.x_off = ddata.x_off;
          this.y_off = ddata.y_off;
          this.x_scale = ddata.x_scale;
          this.y_scale = ddata.y_scale;
          this.canvasX = ddata.x_canvas;
          this.canvasY = ddata.y_canvas;
        } else {
          console.log("I did not receive it ");
        }
      })
      .catch((err) => {
        console.log(err);
      });
    // æŸ¥æˆåˆ†æ˜¯å¦æ˜¯teamå†…çš„æˆå‘˜å¯ä»¥å‚ä¸ç¼–è¾‘
  },
};
</script>

<style>
.container {
  position: fixed;
  top: 0;
  left: 0;
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  background-image: linear-gradient(220.55deg, #565656 0%, #181818 100%);

  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  justify-content: center; /* æ°´å¹³å±…ä¸­ */
  align-items: center; /* å‚ç›´å±…ä¸­ */
}

.leftbar {
  position: fixed;
  top: 0;
  left: 0;
  margin: 0;
  padding: 0;
  /* width: 10%; */
  height: 100%;
  /* background-size: cover;
  background-position: center; */
  /* background-image: linear-gradient(220.55deg, #565656 0%, #181818 100%); */

  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  justify-content: center; /* æ°´å¹³å±…ä¸­ */
  align-items: center; /* å‚ç›´å±…ä¸­ */
}
</style>
  